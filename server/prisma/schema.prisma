generator client {
  provider = "prisma-client-js"
}

// Prisma 默认使用 DATABASE_URL，但我们会在 Nest 的 PrismaService 中按需注入连接串。
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== 枚举类型 ====================

/// 状态枚举
enum Status {
  NORMAL   @map("0")
  DISABLED @map("1")
}

/// 删除标志枚举
enum DelFlag {
  NORMAL  @map("0")
  DELETED @map("1")
}

/// 是/否枚举
enum YesNo {
  YES @map("Y")
  NO  @map("N")
}

/// 配置类型枚举
enum ConfigType {
  YES @map("Y")
  NO  @map("N")
}

/// 用户类型枚举
enum UserType {
  SYSTEM @map("00")  // 系统用户
  NORMAL @map("01")  // 普通用户
  GUEST  @map("02")  // 访客用户
}

/// 设备类型枚举
enum DeviceType {
  PC     @map("0")
  MOBILE @map("1")
}

/// 性别枚举
enum Gender {
  MALE    @map("0")
  FEMALE  @map("1")
  UNKNOWN @map("2")
}

/// 菜单类型枚举
enum MenuType {
  DIRECTORY @map("M")  // 目录
  MENU      @map("C")  // 菜单
  BUTTON    @map("F")  // 按钮
}

/// 通知类型枚举
enum NoticeType {
  NOTICE       @map("1")  // 通知
  ANNOUNCEMENT @map("2")  // 公告
}

/// 数据范围枚举
enum DataScope {
  ALL            @map("1")  // 全部数据权限
  CUSTOM         @map("2")  // 自定数据权限
  DEPT           @map("3")  // 部门数据权限
  DEPT_AND_CHILD @map("4")  // 部门及以下数据权限
  SELF           @map("5")  // 仅本人数据权限
}

/// 代码生成类型枚举
enum GenType {
  ZIP  @map("0")  // zip压缩包
  PATH @map("1")  // 自定义路径
}

// ==================== 租户相关表 ====================

/// 租户表
model SysTenant {
  id              Int       @id @default(autoincrement())
  tenantId        String    @unique @map("tenant_id") @db.VarChar(20)
  contactUserName String?   @map("contact_user_name") @db.VarChar(50)
  contactPhone    String?   @map("contact_phone") @db.VarChar(20)
  companyName     String    @map("company_name") @db.VarChar(100)
  licenseNumber   String?   @map("license_number") @db.VarChar(50)
  address         String?   @db.VarChar(200)
  intro           String?   @db.Text
  domain          String?   @db.VarChar(100)
  packageId       Int?      @map("package_id")
  expireTime      DateTime? @map("expire_time") @db.Timestamp(6)
  accountCount    Int       @default(-1) @map("account_count")
  storageQuota    Int       @default(10240) @map("storage_quota") // 存储配额(MB)，默认10GB
  storageUsed     Int       @default(0) @map("storage_used") // 已使用存储(MB)
  status          Status    @default(NORMAL)
  delFlag         DelFlag   @default(NORMAL) @map("del_flag")
  createBy        String    @default("") @map("create_by") @db.VarChar(64)
  createTime      DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy        String    @default("") @map("update_by") @db.VarChar(64)
  updateTime      DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark          String?   @db.VarChar(500)

  @@map("sys_tenant")
}

/// 租户套餐表
model SysTenantPackage {
  packageId          Int       @id @default(autoincrement()) @map("package_id")
  packageName        String    @map("package_name") @db.VarChar(50)
  menuIds            String?   @map("menu_ids") @db.Text
  menuCheckStrictly  Boolean   @default(false) @map("menu_check_strictly")
  status             Status    @default(NORMAL)
  delFlag            DelFlag   @default(NORMAL) @map("del_flag")
  createBy           String    @default("") @map("create_by") @db.VarChar(64)
  createTime         DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy           String    @default("") @map("update_by") @db.VarChar(64)
  updateTime         DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark             String?   @db.VarChar(500)

  @@map("sys_tenant_package")
}

/// 客户端表
model SysClient {
  id            Int       @id @default(autoincrement())
  clientId      String    @unique @map("client_id") @db.VarChar(64)
  clientKey     String    @map("client_key") @db.VarChar(64)
  clientSecret  String    @map("client_secret") @db.VarChar(255)
  grantTypeList String?   @map("grant_type_list") @db.VarChar(255)
  deviceType    String?   @map("device_type") @db.VarChar(20)
  activeTimeout Int       @default(1800) @map("active_timeout")
  timeout       Int       @default(86400)
  status        Status    @default(NORMAL)
  delFlag       DelFlag   @default(NORMAL) @map("del_flag")
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@map("sys_client")
}

// ==================== 业务表 ====================

model GenTable {
  tableId        Int       @id @default(autoincrement()) @map("table_id")
  tableName      String    @map("table_name") @db.VarChar(200)
  tableComment   String    @map("table_comment") @db.VarChar(500)
  subTableName   String?   @map("sub_table_name") @db.VarChar(64)
  subTableFkName String?   @map("sub_table_fk_name") @db.VarChar(64)
  className      String    @map("class_name") @db.VarChar(100)
  tplCategory    String    @map("tpl_category") @db.VarChar(200)
  tplWebType     String    @map("tpl_web_type") @db.VarChar(30)
  packageName    String    @map("package_name") @db.VarChar(100)
  moduleName     String    @map("module_name") @db.VarChar(30)
  businessName   String    @map("business_name") @db.VarChar(30)
  functionName   String    @map("function_name") @db.VarChar(50)
  functionAuthor String    @map("function_author") @db.VarChar(50)
  genType        GenType   @default(ZIP) @map("gen_type")
  genPath        String    @map("gen_path") @db.VarChar(200)
  options        String    @db.VarChar(1000)
  status         Status
  delFlag        DelFlag   @map("del_flag")
  createBy       String    @map("create_by") @db.VarChar(64)
  createTime     DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy       String    @map("update_by") @db.VarChar(64)
  updateTime     DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark         String?   @db.VarChar(500)

  columns GenTableColumn[]

  @@map("gen_table")
}

model GenTableColumn {
  columnId     Int       @id @default(autoincrement()) @map("column_id")
  tableId      Int       @map("table_id")
  columnName   String    @map("column_name") @db.VarChar(200)
  columnComment String   @map("column_comment") @db.VarChar(500)
  columnType   String    @map("column_type") @db.VarChar(100)
  javaType     String    @map("java_type") @db.VarChar(500)
  javaField    String    @map("java_field") @db.VarChar(200)
  isPk         YesNo     @map("is_pk")
  isIncrement  YesNo     @map("is_increment")
  isRequired   YesNo     @map("is_required")
  isInsert     YesNo     @map("is_insert")
  isEdit       YesNo?    @map("is_edit")
  isList       YesNo?    @map("is_list")
  isQuery      YesNo?    @map("is_query")
  queryType    String    @map("query_type") @db.VarChar(200)
  htmlType     String    @map("html_type") @db.VarChar(200)
  dictType     String    @map("dict_type") @db.VarChar(200)
  columnDefault String?  @map("column_default") @db.VarChar(200)
  sort         Int       @db.Integer
  status       Status
  delFlag      DelFlag   @map("del_flag")
  createBy     String    @map("create_by") @db.VarChar(64)
  createTime   DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy     String    @map("update_by") @db.VarChar(64)
  updateTime   DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark       String?   @db.VarChar(500)

  table GenTable @relation(fields: [tableId], references: [tableId], onDelete: Cascade)

  @@map("gen_table_column")
}

/// 系统级配置表（全局，无租户隔离）
model SysSystemConfig {
  configId    Int       @id @default(autoincrement()) @map("config_id")
  configName  String    @map("config_name") @db.VarChar(100)
  configKey   String     @unique @map("config_key") @db.VarChar(100)
  configValue String     @map("config_value") @db.VarChar(500)
  configType  ConfigType @map("config_type")
  createBy    String     @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark      String?   @db.VarChar(500)
  status      Status    @default(NORMAL)
  delFlag     DelFlag   @default(NORMAL) @map("del_flag")

  @@index([status])
  @@index([configType])
  @@index([delFlag, status])
  @@index([createTime])
  @@map("sys_system_config")
}

/// 租户级配置表（多租户隔离）
model SysConfig {
  configId    Int       @id @default(autoincrement()) @map("config_id")
  tenantId    String    @default("000000") @map("tenant_id") @db.VarChar(20)
  configName  String     @map("config_name") @db.VarChar(100)
  configKey   String     @map("config_key") @db.VarChar(100)
  configValue String     @map("config_value") @db.VarChar(500)
  configType  ConfigType @map("config_type")
  createBy    String     @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark      String?   @db.VarChar(500)
  status      Status    @default(NORMAL)
  delFlag     DelFlag   @default(NORMAL) @map("del_flag")

  @@unique([tenantId, configKey], name: "unique_tenant_config_key")
  @@index([tenantId, status])
  @@index([tenantId, configType])
  @@index([tenantId, delFlag, status])
  @@index([configKey])
  @@index([createTime])
  @@map("sys_config")
}

model SysDept {
  deptId    Int       @id @default(autoincrement()) @map("dept_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  parentId  Int       @map("parent_id")
  ancestors String    @db.VarChar(50)
  deptName  String    @map("dept_name") @db.VarChar(30)
  orderNum  Int       @map("order_num")
  leader    String    @default("") @db.VarChar(20)
  phone     String    @default("") @db.VarChar(11)
  email     String    @default("") @db.VarChar(50)
  status    Status    @default(NORMAL)
  delFlag   DelFlag   @default(NORMAL) @map("del_flag")
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, parentId])
  @@index([status])
  @@index([tenantId, delFlag, status])
  @@index([parentId])
  @@map("sys_dept")
}

model SysDictData {
  dictCode   Int       @id @default(autoincrement()) @map("dict_code")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  dictSort   Int       @default(0) @map("dict_sort")
  dictLabel  String    @map("dict_label") @db.VarChar(100)
  dictValue  String    @map("dict_value") @db.VarChar(100)
  dictType   String    @map("dict_type") @db.VarChar(100)
  cssClass   String    @default("") @map("css_class") @db.VarChar(100)
  listClass  String    @default("") @map("list_class") @db.VarChar(100)
  isDefault  YesNo     @default(NO) @map("is_default")
  status     Status    @default(NORMAL)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark     String?   @db.VarChar(500)
  delFlag    DelFlag   @default(NORMAL) @map("del_flag")

  @@unique([tenantId, dictType, dictValue], name: "unique_tenant_dict_data")
  @@index([tenantId, dictType, status])
  @@index([dictType])
  @@map("sys_dict_data")
}

model SysDictType {
  dictId    Int       @id @default(autoincrement()) @map("dict_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  dictName  String    @map("dict_name") @db.VarChar(100)
  dictType  String    @map("dict_type") @db.VarChar(100)
  status    Status    @default(NORMAL)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)
  delFlag   DelFlag   @default(NORMAL) @map("del_flag")

  @@unique([tenantId, dictType], name: "unique_tenant_dict_type")
  @@index([tenantId, status])
  @@index([dictType])
  @@map("sys_dict_type")
}

model SysJob {
  jobId          Int       @id @default(autoincrement()) @map("job_id")
  tenantId       String    @default("000000") @map("tenant_id") @db.VarChar(20)
  jobName        String    @map("job_name") @db.VarChar(64)
  jobGroup       String    @map("job_group") @db.VarChar(64)
  invokeTarget   String    @map("invoke_target") @db.VarChar(500)
  cronExpression String?   @map("cron_expression") @db.VarChar(255)
  misfirePolicy  String?   @map("misfire_policy") @db.VarChar(20)
  concurrent     String?   @db.Char(1)
  status         Status?
  createBy       String    @map("create_by") @db.VarChar(64)
  createTime     DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy       String    @map("update_by") @db.VarChar(64)
  updateTime     DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark         String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([invokeTarget])
  @@map("sys_job")
}

model SysJobLog {
  jobLogId     Int       @id @default(autoincrement()) @map("job_log_id")
  jobName      String    @map("job_name") @db.VarChar(64)
  jobGroup     String    @map("job_group") @db.VarChar(64)
  invokeTarget String    @map("invoke_target") @db.VarChar(500)
  jobMessage   String?   @map("job_message") @db.VarChar(500)
  status       Status
  exceptionInfo String?  @map("exception_info") @db.VarChar(2000)
  createTime   DateTime  @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@map("sys_job_log")
}

model SysLogininfor {
  infoId        Int       @id @default(autoincrement()) @map("info_id")
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  userName      String    @map("user_name") @db.VarChar(50)
  ipaddr        String    @db.VarChar(128)
  loginLocation String    @default("") @map("login_location") @db.VarChar(255)
  browser       String     @db.VarChar(50)
  os            String     @db.VarChar(50)
  deviceType    DeviceType @default(PC) @map("device_type")
  status        Status
  msg           String    @db.VarChar(255)
  delFlag       DelFlag   @default(NORMAL) @map("del_flag")
  loginTime     DateTime  @map("login_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@index([tenantId, loginTime])
  @@index([userName])
  @@index([status])
  @@index([loginTime])
  @@index([tenantId, userName, loginTime])
  @@index([tenantId, status, loginTime])
  @@map("sys_logininfor")
}

model SysMenu {
  menuId    Int       @id @default(autoincrement()) @map("menu_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  menuName  String    @map("menu_name") @db.VarChar(50)
  parentId  Int       @map("parent_id")
  orderNum  Int       @map("order_num")
  path      String    @default("") @db.VarChar(200)
  component String?   @db.VarChar(255)
  query     String    @default("") @db.VarChar(255)
  isFrame   YesNo     @default(NO) @map("is_frame")
  isCache   YesNo     @default(NO) @map("is_cache")
  menuType  MenuType  @map("menu_type")
  visible   YesNo     @default(YES) @map("visible")
  status    Status
  perms     String    @default("") @db.VarChar(100)
  icon      String    @default("") @db.VarChar(100)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)
  delFlag   DelFlag   @default(NORMAL) @map("del_flag")

  @@index([tenantId, status])
  @@index([tenantId, parentId])
  @@index([status])
  @@index([tenantId, delFlag, status])
  @@index([parentId, orderNum])
  @@map("sys_menu")
}

model SysNotice {
  noticeId      Int        @id @default(autoincrement()) @map("notice_id")
  tenantId      String     @default("000000") @map("tenant_id") @db.VarChar(20)
  noticeTitle   String     @map("notice_title") @db.VarChar(50)
  noticeType    NoticeType @map("notice_type")
  noticeContent String?    @map("notice_content") @db.Text
  status        Status    @default(NORMAL)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  delFlag       DelFlag   @default(NORMAL) @map("del_flag")
  remark        String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, noticeType])
  @@index([tenantId, createTime])
  @@index([tenantId, delFlag, status])
  @@index([createTime])
  @@map("sys_notice")
}

model SysOperLog {
  operId       Int       @id @default(autoincrement()) @map("oper_id")
  tenantId     String    @default("000000") @map("tenant_id") @db.VarChar(20)
  title        String    @db.VarChar(50)
  businessType Int       @map("business_type")
  requestMethod String   @map("request_method") @db.VarChar(10)
  operatorType Int       @map("operator_type")
  operName     String    @map("oper_name") @db.VarChar(50)
  deptName     String    @map("dept_name") @db.VarChar(50)
  operUrl      String    @map("oper_url") @db.VarChar(255)
  operLocation String    @map("oper_location") @db.VarChar(255)
  operParam    String    @map("oper_param") @db.VarChar(2000)
  jsonResult   String    @map("json_result") @db.VarChar(2000)
  errorMsg     String    @map("error_msg") @db.VarChar(2000)
  method       String    @db.VarChar(100)
  operIp       String    @map("oper_ip") @db.VarChar(255)
  operTime     DateTime  @map("oper_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  status       Status
  costTime     Int       @map("cost_time")

  @@index([tenantId, operTime])
  @@index([operName])
  @@index([status])
  @@index([operTime])
  @@index([businessType])
  @@index([tenantId, status, operTime])
  @@index([tenantId, operName, operTime])
  @@map("sys_oper_log")
}

model SysPost {
  postId    Int       @id @default(autoincrement()) @map("post_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  deptId    Int?      @map("dept_id")
  postCode  String    @map("post_code") @db.VarChar(64)
  postCategory String? @map("post_category") @db.VarChar(100)
  postName  String    @map("post_name") @db.VarChar(50)
  postSort  Int       @default(0) @map("post_sort")
  status    Status    @default(NORMAL)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)
  delFlag   DelFlag   @default(NORMAL) @map("del_flag")

  @@index([tenantId, status])
  @@index([deptId])
  @@index([tenantId, delFlag, status])
  @@map("sys_post")
}

model SysRole {
  roleId           Int       @id @default(autoincrement()) @map("role_id")
  tenantId         String    @default("000000") @map("tenant_id") @db.VarChar(20)
  roleName         String    @map("role_name") @db.VarChar(30)
  roleKey          String    @map("role_key") @db.VarChar(100)
  roleSort         Int       @map("role_sort")
  dataScope        DataScope @default(ALL) @map("data_scope")
  menuCheckStrictly Boolean  @map("menu_check_strictly") @default(false)
  deptCheckStrictly Boolean  @map("dept_check_strictly") @default(false)
  status           Status    @default(NORMAL)
  delFlag          DelFlag   @default(NORMAL) @map("del_flag")
  createBy         String    @default("") @map("create_by") @db.VarChar(64)
  createTime       DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy         String    @default("") @map("update_by") @db.VarChar(64)
  updateTime       DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark           String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, delFlag, status])
  @@index([tenantId, roleKey])
  @@index([roleKey])
  @@map("sys_role")
}

model SysRoleDept {
  roleId Int @map("role_id")
  deptId Int @map("dept_id")

  @@id([roleId, deptId])
  @@map("sys_role_dept")
}

model SysRoleMenu {
  roleId Int @map("role_id")
  menuId Int @map("menu_id")

  @@id([roleId, menuId])
  @@index([roleId])
  @@index([menuId])
  @@map("sys_role_menu")
}

/// 文件夹表
model SysFileFolder {
  folderId   Int       @id @default(autoincrement()) @map("folder_id")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  parentId   Int       @default(0) @map("parent_id")
  folderName String    @map("folder_name") @db.VarChar(100)
  folderPath String    @map("folder_path") @db.VarChar(500)
  orderNum   Int       @default(0) @map("order_num")
  status     Status    @default(NORMAL)
  delFlag    DelFlag   @default(NORMAL) @map("del_flag")
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark     String?   @db.VarChar(500)

  @@index([tenantId, parentId])
  @@map("sys_file_folder")
}

/// 文件表（扩展原 SysUpload）
model SysUpload {
  uploadId      String    @id @map("upload_id") @db.VarChar(255)
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  folderId      Int       @default(0) @map("folder_id")
  size          Int
  fileName      String    @map("file_name") @db.VarChar(255)
  newFileName   String    @map("new_file_name") @db.VarChar(255)
  url           String    @db.VarChar(500)
  ext           String?   @db.VarChar(50)
  mimeType      String?   @map("mime_type") @db.VarChar(100)
  storageType   String    @default("local") @map("storage_type") @db.VarChar(20)
  fileMd5       String?   @map("file_md5") @db.VarChar(32)
  thumbnail     String?   @db.VarChar(500) // 缩略图URL
  parentFileId  String?   @map("parent_file_id") @db.VarChar(255) // 父文件ID（用于版本控制）
  version       Int       @default(1) // 版本号
  isLatest      Boolean   @default(true) @map("is_latest") // 是否最新版本
  downloadCount Int       @default(0) @map("download_count")
  status        Status    @default(NORMAL)
  delFlag       DelFlag   @default(NORMAL) @map("del_flag")
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark        String?   @db.VarChar(500)

  // Relations
  shares        SysFileShare[]

  @@index([tenantId, folderId])
  @@index([fileMd5, delFlag])
  @@index([parentFileId, version])
  @@map("sys_upload")
}

/// 文件分享表
model SysFileShare {
  shareId    String    @id @default(uuid()) @map("share_id") @db.VarChar(64)
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  uploadId   String    @map("upload_id") @db.VarChar(255)
  shareCode  String?   @map("share_code") @db.VarChar(6)
  expireTime DateTime? @map("expire_time") @db.Timestamp(6)
  maxDownload Int      @default(-1) @map("max_download")
  downloadCount Int    @default(0) @map("download_count")
  status     Status    @default(NORMAL)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  
  // Relations
  upload     SysUpload @relation(fields: [uploadId], references: [uploadId], onDelete: Cascade)

  @@index([shareId, shareCode])
  @@index([uploadId])
  @@map("sys_file_share")
}

model SysUser {
  userId    Int       @id @default(autoincrement()) @map("user_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  deptId    Int?      @map("dept_id")
  userName  String    @map("user_name") @db.VarChar(30)
  nickName  String    @map("nick_name") @db.VarChar(30)
  userType  UserType  @map("user_type")
  email     String    @default("") @db.VarChar(50)
  phonenumber String  @default("") @db.VarChar(11)
  sex       Gender    @default(MALE)
  avatar    String    @default("") @db.VarChar(255)
  password  String    @db.VarChar(200)
  status    Status    @default(NORMAL)
  delFlag   DelFlag   @default(NORMAL) @map("del_flag")
  loginIp   String    @default("") @map("login_ip") @db.VarChar(128)
  loginDate DateTime? @map("login_date") @db.Timestamp(6)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, userName])
  @@index([tenantId, createTime])
  @@index([tenantId, phonenumber])
  @@index([tenantId, email])
  @@index([tenantId, delFlag, status])
  @@index([userName])
  @@index([deptId])
  @@index([status])
  @@index([phonenumber])
  @@index([email])
  @@map("sys_user")
}

model SysUserPost {
  userId Int @map("user_id")
  postId Int @map("post_id")

  @@id([userId, postId])
  @@index([postId])
  @@map("sys_user_post")
}

model SysUserRole {
  userId Int @map("user_id")
  roleId Int @map("role_id")

  @@id([userId, roleId])
  @@index([roleId])
  @@map("sys_user_role")
}
